<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passenger Flight Communication System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@100..900&family=Geist+Mono:wght@100..900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Geist', 'system-ui', 'sans-serif'],
                        mono: ['Geist Mono', 'monospace'],
                    },
                    colors: {
                        background: 'oklch(var(--background))',
                        foreground: 'oklch(var(--foreground))',
                        card: 'oklch(var(--card))',
                        'card-foreground': 'oklch(var(--card-foreground))',
                        primary: 'oklch(var(--primary))',
                        'primary-foreground': 'oklch(var(--primary-foreground))',
                        secondary: 'oklch(var(--secondary))',
                        'secondary-foreground': 'oklch(var(--secondary-foreground))',
                        muted: 'oklch(var(--muted))',
                        'muted-foreground': 'oklch(var(--muted-foreground))',
                        accent: 'oklch(var(--accent))',
                        'accent-foreground': 'oklch(var(--accent-foreground))',
                        destructive: 'oklch(var(--destructive))',
                        border: 'oklch(var(--border))',
                        input: 'oklch(var(--input))',
                        ring: 'oklch(var(--ring))',
                    },
                    borderRadius: {
                        lg: 'var(--radius)',
                        md: 'calc(var(--radius) - 2px)',
                        sm: 'calc(var(--radius) - 4px)',
                    },
                }
            }
        }
    </script>
    <style>
        :root {
            --radius: 0.625rem;
            --background: 1 0 0;
            --foreground: 0.145 0 0;
            --card: 1 0 0;
            --card-foreground: 0.145 0 0;
            --primary: 0.205 0 0;
            --primary-foreground: 0.985 0 0;
            --secondary: 0.97 0 0;
            --secondary-foreground: 0.205 0 0;
            --muted: 0.97 0 0;
            --muted-foreground: 0.556 0 0;
            --accent: 0.97 0 0;
            --accent-foreground: 0.205 0 0;
            --destructive: 0.577 0.245 27.325;
            --border: 0.922 0 0;
            --input: 0.922 0 0;
            --ring: 0.708 0 0;
        }

        .dark {
            --background: 0.145 0 0;
            --foreground: 0.985 0 0;
            --card: 0.205 0 0;
            --card-foreground: 0.985 0 0;
            --primary: 0.922 0 0;
            --primary-foreground: 0.205 0 0;
            --secondary: 0.269 0 0;
            --secondary-foreground: 0.985 0 0;
            --muted: 0.269 0 0;
            --muted-foreground: 0.708 0 0;
            --accent: 0.269 0 0;
            --accent-foreground: 0.985 0 0;
            --destructive: 0.704 0.191 22.216;
            --border: 1 0 0 / 10%;
            --input: 1 0 0 / 15%;
            --ring: 0.556 0 0;
        }

        @keyframes pulse-custom {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse-custom {
            animation: pulse-custom 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .listening-glow {
            box-shadow: 0 0 20px theme('colors.green.500');
        }

        .result-enter {
            animation: resultEnter 0.5s ease-out;
        }

        @keyframes resultEnter {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-background text-foreground font-sans antialiased">
    <div class="container mx-auto max-w-7xl p-6 space-y-8">
        <!-- Header -->
        <div class="text-center space-y-2 pb-8 border-b border-border">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                ‚úàÔ∏è Travel Language Assistant
            </h1>
            <p class="text-muted-foreground text-lg">
                Real-time translation for travelers and flight passengers
            </p>
        </div>

        <!-- Connection Status -->
        <div id="connection-status" class="p-4 rounded-lg border text-center font-medium bg-destructive/10 text-destructive border-destructive/20">
            üîå Connecting to server...
        </div>

        <!-- Speech Recognition Display -->
        <div id="speech-display" class="bg-card border border-border rounded-lg p-8 text-center min-h-32 flex flex-col justify-center transition-all duration-300">
            <div id="speech-text" class="text-xl font-medium mb-4">
                <span class="text-muted-foreground italic">üéôÔ∏è Speech recognition ready - speak to see your text here</span>
            </div>
            <div id="speech-meta" class="text-sm text-muted-foreground"></div>
        </div>

        <!-- Status Panel -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-card border border-border rounded-lg p-4 text-center">
                <div id="speech-status" class="flex items-center justify-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-destructive"></div>
                    <span class="text-sm font-medium">Speech Recognition: Checking...</span>
                </div>
            </div>
            <div class="bg-card border border-border rounded-lg p-4 text-center">
                <div id="gemini-status" class="flex items-center justify-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-destructive"></div>
                    <span class="text-sm font-medium">AI Translation: Checking...</span>
                </div>
            </div>
            <div class="bg-card border border-border rounded-lg p-4 text-center">
                <div id="system-status" class="flex items-center justify-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-destructive"></div>
                    <span class="text-sm font-medium">System: Checking...</span>
                </div>
            </div>
        </div>

        <!-- Listening Indicator -->
        <div id="listening-indicator" class="hidden bg-green-50 border-2 border-green-200 rounded-lg p-6 text-center pulse-custom listening-glow">
            <div class="text-4xl mb-2">üéôÔ∏è</div>
            <div class="font-semibold text-green-800">Listening...</div>
            <div class="text-sm text-green-600">Speak clearly for accurate recognition</div>
        </div>

        <!-- Controls Panel -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Voice Translation Section -->
            <div class="bg-card border border-border rounded-lg p-6 space-y-6">
                <h3 class="text-xl font-semibold flex items-center gap-2">
                    üéôÔ∏è Voice Translation
                </h3>
                
                <div class="space-y-4">
                    <div class="space-y-2">
                        <label for="target-language" class="text-sm font-medium">Translate to:</label>
                        <select id="target-language" class="w-full p-3 rounded-md border border-input bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                            <option value="en" selected>English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="ru">Russian</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="ko">Korean</option>
                            <option value="ar">Arabic</option>
                            <option value="hi">Hindi</option>
                            <option value="th">Thai</option>
                            <option value="vi">Vietnamese</option>
                            <option value="nl">Dutch</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label for="context-select" class="text-sm font-medium">Context:</label>
                        <select id="context-select" class="w-full p-3 rounded-md border border-input bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                            <option value="general">General Conversation</option>
                            <option value="travel">Travel & Transportation</option>
                            <option value="food">Food & Dining</option>
                            <option value="hotel">Hotel & Accommodation</option>
                            <option value="shopping">Shopping</option>
                            <option value="emergency">Emergency Situations</option>
                            <option value="directions">Directions & Navigation</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label for="sensitivity" class="text-sm font-medium">Microphone Sensitivity:</label>
                        <div class="flex items-center gap-3">
                            <input type="range" id="sensitivity" min="0.1" max="1" step="0.1" value="0.5" class="flex-1">
                            <span id="sensitivity-value" class="text-sm font-mono bg-muted px-2 py-1 rounded">0.5</span>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <button id="start-listening" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Start Listening
                        </button>
                        <button id="stop-listening" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Stop Listening
                        </button>
                        <button id="demo-speech" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition-colors">
                            Try Demo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Text Translation Section -->
            <div class="bg-card border border-border rounded-lg p-6 space-y-6">
                <h3 class="text-xl font-semibold flex items-center gap-2">
                    üìù Text Translation
                </h3>
                
                <div class="space-y-4">
                    <div class="space-y-2">
                        <label for="source-language" class="text-sm font-medium">From Language:</label>
                        <select id="source-language" class="w-full p-3 rounded-md border border-input bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                            <option value="auto">Auto-detect</option>
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label for="text-target-language" class="text-sm font-medium">To Language:</label>
                        <select id="text-target-language" class="w-full p-3 rounded-md border border-input bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                            <option value="en" selected>English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label for="input-text" class="text-sm font-medium">Text to Translate:</label>
                        <textarea id="input-text" placeholder="Enter text for translation..." class="w-full p-3 rounded-md border border-input bg-background text-foreground min-h-20 resize-y focus:outline-none focus:ring-2 focus:ring-ring"></textarea>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <button id="translate-text" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition-colors">
                            Translate Text
                        </button>
                        <button id="test-system" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md font-medium transition-colors">
                            Test System
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Panel -->
        <div class="space-y-4">
            <h3 class="text-xl font-semibold">üìä Translation Results</h3>
            <div id="results-container" class="space-y-4">
                <div class="bg-card border border-border rounded-lg p-4">
                    <p class="text-muted-foreground italic">Translation results will appear here...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize real Socket.IO connection
        const socket = io();
        
        let isListening = false;
        let systemReady = false;
        let processedResults = new Set(); // Track processed results to avoid duplicates

        // DOM elements
        const startBtn = document.getElementById('start-listening');
        const stopBtn = document.getElementById('stop-listening');
        const demoBtn = document.getElementById('demo-speech');
        const translateBtn = document.getElementById('translate-text');
        const testBtn = document.getElementById('test-system');
        const resultsContainer = document.getElementById('results-container');
        const listeningIndicator = document.getElementById('listening-indicator');
        const speechDisplay = document.getElementById('speech-display');
        const speechText = document.getElementById('speech-text');
        const speechMeta = document.getElementById('speech-meta');
        const sensitivitySlider = document.getElementById('sensitivity');
        const sensitivityValue = document.getElementById('sensitivity-value');
        const connectionStatus = document.getElementById('connection-status');
        const speechStatus = document.getElementById('speech-status');
        const geminiStatus = document.getElementById('gemini-status');
        const systemStatusEl = document.getElementById('system-status');

        // Debug logging
        console.log('Initializing Travel Language Assistant...');

        // Update sensitivity display
        sensitivitySlider.addEventListener('input', function() {
            sensitivityValue.textContent = this.value;
        });

        // Socket event handlers
        socket.on('connect', function() {
            console.log('‚úÖ Connected to server');
            connectionStatus.textContent = '‚úÖ Connected to server';
            connectionStatus.className = 'p-4 rounded-lg border text-center font-medium bg-green-50 text-green-700 border-green-200';
        });

        socket.on('disconnect', function() {
            console.log('‚ùå Disconnected from server');
            connectionStatus.textContent = '‚ùå Disconnected from server';
            connectionStatus.className = 'p-4 rounded-lg border text-center font-medium bg-destructive/10 text-destructive border-destructive/20';
            isListening = false;
            updateListeningUI();
        });

        socket.on('status', function(data) {
            console.log('üìä Status update received:', data);
            
            // Update system status indicators
            if (data.speech_available !== undefined) {
                const indicator = speechStatus.querySelector('div');
                const text = speechStatus.querySelector('span');
                if (data.speech_available) {
                    indicator.className = 'w-3 h-3 rounded-full bg-green-500';
                    text.textContent = 'Speech Recognition: Ready';
                } else {
                    indicator.className = 'w-3 h-3 rounded-full bg-red-500';
                    text.textContent = 'Speech Recognition: Not Available';
                }
            }

            if (data.gemini_available !== undefined) {
                const indicator = geminiStatus.querySelector('div');
                const text = geminiStatus.querySelector('span');
                if (data.gemini_available) {
                    indicator.className = 'w-3 h-3 rounded-full bg-green-500';
                    text.textContent = 'AI Translation: Ready';
                } else {
                    indicator.className = 'w-3 h-3 rounded-full bg-yellow-500';
                    text.textContent = 'AI Translation: Basic Mode';
                }
            }

            if (data.system_ready !== undefined) {
                systemReady = data.system_ready;
                const indicator = systemStatusEl.querySelector('div');
                const text = systemStatusEl.querySelector('span');
                if (data.system_ready) {
                    indicator.className = 'w-3 h-3 rounded-full bg-green-500';
                    text.textContent = 'System: Ready';
                    startBtn.disabled = false;
                } else {
                    indicator.className = 'w-3 h-3 rounded-full bg-red-500';
                    text.textContent = 'System: Not Ready';
                    startBtn.disabled = true;
                }
            }
            
            if (data.listening !== undefined) {
                isListening = data.listening;
                console.log('üéôÔ∏è Listening status:', isListening);
                updateListeningUI();
            }
        });

        // FIXED: Handle speech recognition events
        socket.on('speech_recognized', function(data) {
            console.log('üéôÔ∏è Speech recognized:', data);
            
            // Create a unique key for this result
            const resultKey = `speech_${data.timestamp}_${data.original_text}`;
            
            // Avoid duplicate processing
            if (processedResults.has(resultKey)) {
                console.log('‚ö†Ô∏è Skipping duplicate speech recognition result');
                return;
            }
            processedResults.add(resultKey);
            
            // Update speech display
            displaySpeechRecognition(data);
            
            // Add to translation results immediately
            addToTranslationResults({
                original_text: data.original_text,
                translated_text: data.translated_text || null,
                source_language: data.source_language,
                target_language: data.target_language || 'N/A',
                confidence: data.confidence || 0.8,
                method: data.method || 'Speech Recognition',
                timestamp: data.timestamp || new Date().toISOString(),
                type: 'Speech Recognition'
            });
        });

        // FIXED: Handle translation results (avoid duplicates)
        socket.on('translation_result', function(data) {
            console.log('üîÑ Translation result:', data);
            
            // Create a unique key for this result
            const resultKey = `translation_${data.timestamp}_${data.original_text}`;
            
            // Only add if not already processed as speech recognition
            if (!processedResults.has(resultKey) && !data.manual_translation) {
                processedResults.add(resultKey);
                addToTranslationResults({
                    ...data,
                    type: data.type || 'Translation'
                });
            } else if (data.manual_translation) {
                // Always add manual translations
                addToTranslationResults({
                    ...data,
                    type: 'Manual Translation'
                });
            }
        });

        socket.on('error', function(data) {
            console.error('‚ùå Error:', data);
            displayError(data.message);
        });

        socket.on('test_results', function(data) {
            console.log('üß™ Test results:', data);
            displayTestResults(data);
        });

        // Button event handlers
        startBtn.addEventListener('click', function() {
            if (!systemReady) {
                displayError('System not ready. Please wait for initialization.');
                return;
            }

            console.log('üéôÔ∏è Starting speech recognition...');
            
            const targetLang = document.getElementById('target-language').value;
            const context = document.getElementById('context-select').value;
            const sensitivity = parseFloat(document.getElementById('sensitivity').value);
            
            console.log('Settings:', { targetLang, context, sensitivity });
            
            socket.emit('start_listening', {
                language: targetLang,
                context: context,
                sensitivity: sensitivity
            });
        });

        stopBtn.addEventListener('click', function() {
            console.log('üõë Stopping speech recognition...');
            socket.emit('stop_listening');
        });

        // Demo button with passenger-friendly example
        demoBtn.addEventListener('click', function() {
            console.log('üé≠ Running demo...');
            const demoData = {
                original_text: "Excuse me, where is the bathroom?",
                translated_text: "Perd√≥n, ¬ød√≥nde est√° el ba√±o?",
                source_language: "en",
                target_language: "es",
                confidence: 0.92,
                timestamp: new Date().toISOString(),
                method: "Demo - Google Speech Recognition"
            };
            
            displaySpeechRecognition(demoData);
            addToTranslationResults({
                ...demoData,
                type: 'Demo Translation'
            });
        });

        translateBtn.addEventListener('click', function() {
            const text = document.getElementById('input-text').value.trim();
            if (!text) {
                displayError('Please enter text to translate');
                return;
            }
            
            const sourceLang = document.getElementById('source-language').value;
            const targetLang = document.getElementById('text-target-language').value;
            const context = document.getElementById('context-select').value;
            
            console.log('üìù Translating text:', { text, sourceLang, targetLang, context });
            
            socket.emit('translate_text', {
                text: text,
                source_language: sourceLang,
                target_language: targetLang,
                context: context
            });
        });

        testBtn.addEventListener('click', function() {
            const targetLang = document.getElementById('text-target-language').value;
            console.log('üß™ Testing system with target language:', targetLang);
            
            socket.emit('test_translation', {
                language: targetLang
            });
        });

        // Speech recognition display function
        function displaySpeechRecognition(data) {
            console.log('üéôÔ∏è Displaying speech recognition:', data);
            
            const confidence = (data.confidence * 100).toFixed(1);
            const confidenceClass = confidence > 80 ? 'text-green-600' : confidence > 60 ? 'text-yellow-600' : 'text-red-600';
            
            // Update the main speech display with better formatting
            speechText.innerHTML = `<span class="text-blue-700">"${data.original_text}"</span>`;
            speechMeta.innerHTML = `
                <strong>Language:</strong> ${data.source_language.toUpperCase()} | 
                <strong>Confidence:</strong> <span class="${confidenceClass}">${confidence}%</span> | 
                <strong>Method:</strong> ${data.method} | 
                <strong>Time:</strong> ${new Date(data.timestamp).toLocaleTimeString()}
            `;
            
            // Add visual feedback
            speechDisplay.classList.add('bg-blue-50', 'border-blue-200');
            setTimeout(() => {
                speechDisplay.classList.remove('bg-blue-50', 'border-blue-200');
            }, 3000);
        }

        function updateListeningUI() {
            console.log('üîÑ Updating UI - Listening:', isListening, 'System Ready:', systemReady);
            
            if (isListening) {
                startBtn.disabled = true;
                stopBtn.disabled = false;
                listeningIndicator.classList.remove('hidden');
                speechText.innerHTML = '<span class="text-green-600 italic">üéôÔ∏è Listening... speak now</span>';
                speechMeta.innerHTML = '';
            } else {
                startBtn.disabled = !systemReady;
                stopBtn.disabled = true;
                listeningIndicator.classList.add('hidden');
                if (speechText.innerHTML.includes('Listening...')) {
                    speechText.innerHTML = '<span class="text-muted-foreground italic">üéôÔ∏è Speech recognition ready - speak to see your text here</span>';
                    speechMeta.innerHTML = '';
                }
            }
        }

        // FIXED: Unified function to add results to Translation Results section
        function addToTranslationResults(data) {
            console.log('üìä Adding to Translation Results:', data);
            
            // Remove the placeholder if it exists
            const placeholder = resultsContainer.querySelector('.text-muted-foreground');
            if (placeholder && placeholder.textContent.includes('Translation results will appear here')) {
                placeholder.parentElement.remove();
            }
            
            const resultCard = document.createElement('div');
            resultCard.className = 'bg-card border border-border rounded-lg p-4 space-y-3 result-enter hover:shadow-md transition-shadow duration-300';
            
            const confidence = (data.confidence * 100).toFixed(1);
            const confidenceClass = confidence > 80 ? 'text-green-600' : confidence > 60 ? 'text-yellow-600' : 'text-red-600';
            
            // Determine the type icon and color
            let typeIcon = 'üîÑ';
            let typeColor = 'text-blue-600';
            if (data.type === 'Speech Recognition') {
                typeIcon = 'üéôÔ∏è';
                typeColor = 'text-green-600';
            } else if (data.type === 'Audio Processing') {
                typeIcon = 'üéµ';
                typeColor = 'text-purple-600';
            } else if (data.type === 'Demo Translation') {
                typeIcon = 'üé≠';
                typeColor = 'text-orange-600';
            } else if (data.type === 'Manual Translation') {
                typeIcon = 'üìù';
                typeColor = 'text-blue-600';
            } else if (data.type === 'Test Translation') {
                typeIcon = 'üß™';
                typeColor = 'text-purple-600';
            }
            
            resultCard.innerHTML = `
                <div class="font-semibold ${typeColor} flex items-center gap-2">
                    ${typeIcon} ${data.type || 'Translation'} Result
                </div>
                <div class="space-y-2">
                    <div class="flex items-start gap-2">
                        <span class="text-sm font-medium text-muted-foreground min-w-[80px]">Original:</span>
                        <span class="font-mono bg-muted px-2 py-1 rounded text-sm flex-1">${data.original_text}</span>
                    </div>
                    ${data.translated_text ? `
                        <div class="flex items-start gap-2">
                            <span class="text-sm font-medium text-muted-foreground min-w-[80px]">Translated:</span>
                            <span class="font-mono bg-blue-50 px-2 py-1 rounded text-sm flex-1">${data.translated_text}</span>
                        </div>
                    ` : ''}
                </div>
                <div class="text-sm text-muted-foreground grid grid-cols-2 md:grid-cols-4 gap-2 pt-2 border-t border-border">
                    <span><strong>Language:</strong> ${data.source_language}${data.target_language && data.target_language !== 'N/A' ? ' ‚Üí ' + data.target_language : ''}</span>
                    <span><strong>Confidence:</strong> <span class="${confidenceClass}">${confidence}%</span></span>
                    <span><strong>Method:</strong> ${data.method}</span>
                    <span><strong>Time:</strong> ${new Date(data.timestamp).toLocaleTimeString()}</span>
                </div>
            `;
            
            resultsContainer.insertBefore(resultCard, resultsContainer.firstChild);
            
            resultsContainer.insertBefore(resultCard, resultsContainer.firstChild);
            
            // Add entrance animation
            resultCard.style.opacity = '0';
            resultCard.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                resultCard.style.opacity = '1';
                resultCard.style.transform = 'translateY(0)';
                resultCard.style.transition = 'all 0.3s ease';
            }, 10);
            
            // Keep only last 15 results
            while (resultsContainer.children.length > 15) {
                resultsContainer.removeChild(resultsContainer.lastChild);
            }
        }

        function displayTestResults(data) {
            data.results.forEach((result, index) => {
                setTimeout(() => {
                    addToTranslationResults({
                        original_text: result.original,
                        translated_text: result.translated,
                        confidence: result.confidence,
                        method: result.method,
                        source_language: 'en',
                        target_language: data.target_language,
                        timestamp: new Date().toISOString(),
                        type: 'Test Translation'
                    });
                }, index * 500);
            });
        }

        function displayError(message) {
            console.error('‚ùå Displaying error:', message);
            const resultCard = document.createElement('div');
            resultCard.className = 'bg-red-50 border border-red-200 rounded-lg p-4 space-y-2';
            resultCard.innerHTML = `
                <div class="font-semibold text-red-700">Error:</div>
                <div class="text-red-600">${message}</div>
                <div class="text-sm text-red-500">Time: ${new Date().toLocaleTimeString()}</div>
            `;
            
            resultsContainer.insertBefore(resultCard, resultsContainer.firstChild);
        }

        // Initialize UI
        updateListeningUI();
        
        console.log('‚úÖ Travel Language Assistant initialized and ready');
    </script>
</body>
</html> 